<KETL>
	<!--  This is a work in progress, that will eventually contain all the valid options for each step -->
	
	
	<STEP CLASS="com.kni.etl.ketl.writer.SQLLoaderELTWriter">
		<PARAMETERS>
			<PARAMETER NAME="USER" REQUIRED="TRUE" />
			<PARAMETER NAME="PASSWORD" REQUIRED="TRUE" />
			<PARAMETER NAME="URL" REQUIRED="TRUE" />
			<PARAMETER NAME="DRIVER" REQUIRED="TRUE" />
			<PARAMETER NAME="CONNECTIONSTRING" REQUIRED="TRUE" />
			<PARAMETER NAME="PRESQL" REQUIRED="FALSE" />
		</PARAMETERS>
		<ATTRIBUTES>
			<ATTRIBUTE NAME="TYPE">
				<VALUE>ROLL</VALUE>
				<VALUE>UPSERT</VALUE>
			</ATTRIBUTE>
		</ATTRIBUTES>
		<PORTS>
			<PRESQL>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="CRITICAL" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PERPARTITION" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</PRESQL>
			<IN>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="SK" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PK" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="COMPARE" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="INSERT" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="UPDATE" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</IN>
			<POSTSQL>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="CRITICAL" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PERPARTITION" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</POSTSQL>
		</PORTS>		
		<TEMPLATES>
			<GROUP NAME="DEFAULT">
				<TEMPLATE NAME="CREATETABLE">create table ${NEWTABLENAME} as select ${SOURCECOLUMNS} from ${SOURCETABLENAME} WHERE 1=0</TEMPLATE>
				<TEMPLATE NAME="SELECTCOLUMNDATATYPE">select ${COLUMNS} from ${TABLENAME} WHERE 1=0</TEMPLATE>
				<TEMPLATE NAME="UPDATEPOSTBATCH">update ${DESTINATIONTABLENAME} inner JOIN ${SOURCETABLENAME} on (($JOIN) AND (${UPDATETRIGGERS})) set ${UPDATECOLUMNS}</TEMPLATE>
				<TEMPLATE NAME="INSERTPOSTBATCH">insert into ${DESTINATIONTABLENAME}(${DESTINATIONCOLUMNS}) select ${SOURCECOLUMNS} from ${SOURCETABLENAME} where not exists (select 1 from ${DESTINATIONTABLENAME} where ${JOIN})</TEMPLATE>
				<TEMPLATE NAME="DROPTABLE">drop table ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="TRUNCATETABLE">truncate table ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="RENAMETABLE">alter table ${TABLENAME} rename to ${NEWTABLENAME}</TEMPLATE>
				<TEMPLATE NAME="CREATEUNIQUEINDEX">create unique index ${INDEXNAME} on ${TABLENAME}(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="CREATEINDEX">create index ${INDEXNAME} on ${TABLENAME}(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="ADDPRIMARYKEY">alter table ${TABLENAME} add primary key(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="COALESCE">coalesce(${ARG1},${ARG2})</TEMPLATE>
				<TEMPLATE NAME="ANALYZETABLE">analyze table ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="SQLLDR">sqlldr ${USER}/${PASSWORD}@${CONNECTIONSTRING} control=${CONTROLFILE} data=${DATASOURCE} bad=${BADDATA}</TEMPLATE>
				<TEMPLATE NAME="MERGETONEWTABLE">CREATE TABLE ${NEWTABLENAME} AS SELECT ${KEYCOLUMNS} ${OTHERCOLUMNS} FROM ${STGTABLE} as a full outer join ${ORIGTABLE} as b on (${JOIN})</TEMPLATE>
			</GROUP>
		</TEMPLATES>
	</STEP>
</KETL>
