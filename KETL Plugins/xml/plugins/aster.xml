<KETL>
	<!--  This is a work in progress, that will eventually contain all the valid options for each step -->


	<STEP CLASS="com.kni.etl.ketl.writer.AsterBulkWriter">
		<PARAMETERS>
			<PARAMETER NAME="USER" REQUIRED="TRUE" />
			<PARAMETER NAME="PASSWORD" REQUIRED="TRUE" />
			<PARAMETER NAME="URL" REQUIRED="TRUE" />
			<PARAMETER NAME="DRIVER" REQUIRED="TRUE" />
			<PARAMETER NAME="PRESQL" REQUIRED="FALSE" />
		</PARAMETERS>
		<ATTRIBUTES>
			<ATTRIBUTE NAME="TYPE">
				<VALUE>BULK</VALUE>
				<VALUE>ROLL</VALUE>
				<VALUE>UPSERT</VALUE>
			</ATTRIBUTE>
		</ATTRIBUTES>
		<PORTS>
			<PRESQL>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="CRITICAL" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PERPARTITION" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</PRESQL>
			<IN>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="SK" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PK" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="COMPARE" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="INSERT" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="UPDATE" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</IN>
			<POSTSQL>
				<ATTRIBUTES>
					<ATTRIBUTE NAME="CRITICAL" TYPE="BOOLEAN" />
					<ATTRIBUTE NAME="PERPARTITION" TYPE="BOOLEAN" />
				</ATTRIBUTES>
			</POSTSQL>
		</PORTS>		
		<TEMPLATES>
			<GROUP NAME="DEFAULT">
				<TEMPLATE NAME="UPDATECOLUMNFORMAT">${TARGETCOLUMN}=${SOURCECOLUMN}</TEMPLATE>						
				<TEMPLATE NAME="UPDATEPOSTBATCH">update ${DESTINATIONTABLENAME} set ${UPDATECOLUMNS} from ${SOURCETABLENAME} where (${JOIN}) AND exists (Select 1 from ${SOURCETABLENAME} where (${JOIN}) AND (${UPDATETRIGGERS}))</TEMPLATE>
				<TEMPLATE NAME="ANALYZETABLE">analyze ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="ADDHASHCOLUMN">alter table ${TABLENAME} add ${COLUMNNAME} int</TEMPLATE>
				<TEMPLATE NAME="DISABLEINDEX"/>			
				<TEMPLATE NAME="ENABLEINDEX"/>			
				<TEMPLATE NAME="ADDHASHCOLUMN">alter table ${TABLENAME} add ${COLUMNNAME} PLS_INTEGER</TEMPLATE>			
				<TEMPLATE NAME="STATEMENTSEPERATOR">;</TEMPLATE>			
				<TEMPLATE NAME="INSERT">insert into ${DESTINATIONTABLENAME}(${DESTINATIONCOLUMNS}${DEDUPECOLUMN}) VALUES(${VALUES})</TEMPLATE>
				<TEMPLATE NAME="CREATETABLE">create table ${NEWTABLENAME} as select ${SOURCECOLUMNS}${DEDUPECOLUMN} from ${SOURCETABLENAME} WHERE 1=0</TEMPLATE>
				<TEMPLATE NAME="SELECTCOLUMNDATATYPE">select ${COLUMNS} from ${TABLENAME} WHERE 1=0</TEMPLATE>
				<TEMPLATE NAME="INSERTPOSTBATCH">insert into ${DESTINATIONTABLENAME}(${INSERTDESTINATIONCOLUMNS}) select ${INSERTCOLUMNS} from ${SOURCETABLENAME} where not exists (select 1 from ${DESTINATIONTABLENAME} where ${JOIN})</TEMPLATE>
				<TEMPLATE NAME="DELETEDUPLICATES">delete from ${SOURCETABLENAME} where (${KEYS},${DEDUPECOLUMN}) not in (SELECT ${KEYS},MAX(${DEDUPECOLUMN}) FROM ${SOURCETABLENAME} GROUP BY ${KEYS})</TEMPLATE>
				<TEMPLATE NAME="DROPTABLE">drop table ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="TRUNCATETABLE">truncate table ${TABLENAME}</TEMPLATE>
				<TEMPLATE NAME="RENAMETABLE">alter table ${TABLENAME} rename to ${NEWTABLENAME}</TEMPLATE>
				<TEMPLATE NAME="CREATEUNIQUEINDEX">create unique index ${TABLENAME}${INDEXNAME} on ${TABLENAME}(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="CREATEINDEX">create index ${TABLENAME}${INDEXNAME} on ${TABLENAME}(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="ADDPRIMARYKEY">alter table ${TABLENAME} add primary key(${COLUMNS})</TEMPLATE>
				<TEMPLATE NAME="COALESCE">coalesce(${ARG1},${ARG2})</TEMPLATE>
				<TEMPLATE NAME="MERGETONEWTABLE">CREATE TABLE ${NEWTABLENAME} AS SELECT ${KEYCOLUMNS} ${OTHERCOLUMNS} FROM ${STGTABLE} as a full outer join ${ORIGTABLE} as b on (${JOIN})</TEMPLATE>
			</GROUP>
		</TEMPLATES>
	</STEP>
</KETL>
